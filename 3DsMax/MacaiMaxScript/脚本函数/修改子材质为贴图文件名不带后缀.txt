--获取场景中物体所用的所有材质
--这些材质应当少于scenematerials
fn GetAllMatUsedByScene = 
	(
		allmats=#()
		max select all
		for obj in Selection do (
			if obj.material!=undefined then (
				append allmats obj.material
				if classof obj.material==Multimaterial then (
					for x in obj.material.materialList do (
						if x!=undefined then
							append allmats x
					)
				)
			)
		)
		max select none
		return allmats
	)


--收集场景中所有子材质
for mat in scenematerials do 
		(
		  if ( classof mat  == Multimaterial) then (
			  for i=1 to mat.numsubs do (

				if mat[i]!=undefined then (
					--收集每一个子材质
					append allSubMats mat[i]
				)
				else (
					messagebox "不应当出现无定义材质"
				)
			  )
		  )
		  else (
		      --普通材质，我们先打印一下他的名字
			 messagebox "在场景材质中，不应当出现普通材质"
		  )


--修改子材质为贴图文件名不带后缀
fn ChangeAllSubMatsFilePathAndName allsubmats = (
		 tilepath = maxfilepath--获得当前打开的max路径
		
		
		 for mat in allsubmats do (
            --带路径的文件名 
			 filepathname = mat.diffusemap.filename
			
			--获取文件名字
		       filename0 = filenameFromPath filepathname
			   filename = ToUpper filename0
			 
			    --这里修改子材质的对应的diffusemap的文件名字(包括路径)
				mat.diffusemap.filename= tilepath+filename

				--这里修改贴图的名字，就是文件名字，不要后缀
				mat.diffusemap.name = getFileNameFile filename
                mat.name  = mat.diffusemap.name 
		 )
	)
