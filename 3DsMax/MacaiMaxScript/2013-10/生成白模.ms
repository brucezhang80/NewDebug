---处理三维矢量线--1打散，焊接，转多变形，2附加，焊接，打散，3拉面，4布尔，5去高光fn breakAndWeldSpline obj=(	convertto obj splineShape 	splineOps.startBreak obj	select obj	max modify mode	subobjectLevel = 1	max select invert	splineOps.weld obj	updateShape obj	convertto obj editable_poly	return obj) fn attachPoly objs=(	--attach	theObj=objs[1]	for i=2 to objs.count do	(		theObj.attach objs[i] theObj 	)	---weld	theObj.weldThreshold=0.02	pNum=polyOp.getNumVerts theObj	count=#()	for i=1 to pNum do 	(		append count i	)	polyOp.weldVertsByThreshold theObj count	return theObj)fn detachPoly theObj=(	pElement=#()	faceCount = theObj.getnumfaces()	FaceTest = ((theObj.getnumfaces()) != 0)	for i = 1 to faceCount while FaceTest do	(		newName = (uniquename (theObj.name as string))		theObj.EditablePoly.SetSelection #Face #{1}		theObj.selectElement()		TargetElement = polyop.getFaceSelection theObj		polyop.detachFaces theObj TargetElement asNode:true name:newName					NewObj = getnodebyname newName		append pElement NewObj		FaceTest = ((theObj.getnumfaces()) != 0)	)	delete theObj    return pElement	)fn attachAndWeldAndDetachPoly objs=(	--attach	theObj=objs[1]	for i=2 to objs.count do	(		theObj.attach objs[i] theObj 	)	---weld	theObj.weldThreshold=0.02	pNum=polyOp.getNumVerts theObj	count=#()	for i=1 to pNum do 	(		append count i	)	polyOp.weldVertsByThreshold theObj count	--detach	pElement=#()	faceCount = theObj.getnumfaces()	FaceTest = ((theObj.getnumfaces()) != 0)	for i = 1 to faceCount while FaceTest do	(		newName = (uniquename (theObj.name as string))		theObj.EditablePoly.SetSelection #Face #{1}		theObj.selectElement()		TargetElement = polyop.getFaceSelection theObj		polyop.detachFaces theObj TargetElement asNode:true name:newName					NewObj = getnodebyname newName		append pElement NewObj		FaceTest = ((theObj.getnumfaces()) != 0)	)	delete theObj    return pElement	)fn createFaces obj pHeight=(	pNum=polyop.getNumEdges obj		for i=1 to pNum do 	(		faceCount=(polyop.getEdgeFaces obj i).count		if faceCount ==1 then		(			pVerts=(polyop.getVertsUsingEdge obj i ) as array			pV1=polyOp.getvert obj pVerts[1]			pV2=polyOp.getvert obj pVerts[2]						pV_1=polyop.createVert obj [pV1.x,pV1.y,pHeight] node:true			pV_2=polyop.createVert obj [pV2.x,pV2.y,pHeight] node:true            --pV_1=obj.createVertex [pV1.x,pV1.y,0]			--pV_2=obj.createVertex [pV2.x,pV2.y,0]						polyop.createPolygon obj #(pVerts[1],pV_1,pV_2,pVerts[2])			--obj.EditablePoly.createFace #(pVerts[1],pV_1,pV_2,pVerts[2])		)	)	--weld	obj.weldThreshold=0.02	pNum=polyOp.getNumVerts obj	count=#()	for i=1 to pNum do 	(		append count i	)	polyOp.weldVertsByThreshold obj count	ResetPivot obj 	centerpivot obj	resetxform obj	convertto obj editable_poly)fn superBoolUnion objs=(	temp=objs[1]	deleteitem objs 1	ProBoolean.CreateBooleanObjects temp objs 0 1 0	convertto temp editable_poly	--detach	pElement=#()	faceCount = temp.getnumfaces()	FaceTest = ((temp.getnumfaces()) != 0)	for i = 1 to faceCount while FaceTest do	(		newName = (uniquename (temp.name as string))		temp.EditablePoly.SetSelection #Face #{1}		temp.selectElement()		TargetElement = polyop.getFaceSelection temp		polyop.detachFaces temp TargetElement asNode:true name:newName					NewObj = getnodebyname newName		append pElement NewObj		FaceTest = ((temp.getnumfaces()) != 0)	)	delete temp	return pElement)try(destroydialog plRollout)catch()rollout plRollout "矢量线生成白模" width:150 height:200(	local pSpline=#(),pPoly=#(),thePolys=#(),pDem,pHeight=0,pObj	group "选择Dem"	(	pickButton btn21 "选择Dem"  width:130-- pos:[10,25]height:20	)	group "矢量线处理"	(		button btn1 "预处理"  width:130--pos:[7,50] height:20 		button btn3 "生成白模"  width:130  -- pos:[6,80] height:20		button btn4 "处理白模"  width:130-- height:20pos:[7,140]		--button btn12 "预处理"  width:180-	)	--button btn3 "3" pos:[6,110] width:122 height:20	--	--button btn5 "5" pos:[7,170] width:122 height:20	--button btn6 "all" pos:[7,153] width:122 height:20		on btn21 picked obj do	(		btn21.text=obj.name		pDem=obj	)	on btn1 pressed do 	(		pSpline.count=0		pPoly.count=0		thePolys.count=0		for obj in selection do 		(			if superclassof obj==shape then			(				append pSpline obj			) 			else if superclassof obj==GeometryClass then			(				append pPoly obj			)		)				for obj in pSpline do 		(			if pSpline.count>0 then			(				append thePolys (breakAndWeldSpline obj)			)		)        -------		pObj=attachPoly thePolys		try		(		thePivot=pObj.center		dir=[0,0,-1]		pRay= ray thePivot dir		newRay=intersectRay pDem pRay				if newRay!=undefined then		(				pHeight=newRay.pos.z		)	    )	    catch()		--thePolys=attachAndWeldAndDetachPoly thePolys		-------	)	on btn2 pressed do 	(		thePolys=attachAndWeldAndDetachPoly thePolys	)	on btn3 pressed do 	(				thePolys=detachPoly pObj		for obj in thePolys do 		(			if thePolys.count>0 then			(				createFaces obj pHeight			)		)	)	on btn4 pressed do 	(		join pPoly thePolys		if pPoly.count>1 then		(			thePolys=superBoolUnion pPoly		)		else if selection.count>1 then		(			pPoly=selection			superBoolUnion pPoly		)	)	on btn5 pressed do 	(		for obj in thePolys do			(			if thePolys.count>0 then			(				faceNum=obj.GetNumFaces()				obj.EditablePoly.SetSelection #Face #{1..faceNum}				obj.ButtonOp #ClearSmoothingGroups				convertTo obj editable_poly			)		)	)	on btn6 pressed do 	(			))createdialog plRollout pos:[50,100]